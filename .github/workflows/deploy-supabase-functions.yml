name: Deploy Supabase Functions

# This workflow deploys Supabase Edge Functions to your Supabase project.
# 
# REQUIRED SECRETS:
# - SUPABASE_ACCESS_TOKEN: Your Supabase personal access token
#   Get it from: https://supabase.com/dashboard/account/tokens
# 
# - SUPABASE_PROJECT_REF: Your Supabase project reference ID
#   Get it from: Project Settings > General Settings > Reference ID
#
# To add these secrets:
# 1. Go to GitHub repository Settings > Secrets and variables > Actions
# 2. Click "New repository secret"
# 3. Add both secrets with their respective values
#
# For troubleshooting, see: DEPLOYMENT_TROUBLESHOOTING.md
on:
  push:
    branches: [ main ]

jobs:
  deploy-functions:
    runs-on: ubuntu-latest
    env:
      SUPABASE_ACCESS_TOKEN: ${{ secrets.SUPABASE_ACCESS_TOKEN }}
      SUPABASE_PROJECT_REF: ${{ secrets.SUPABASE_PROJECT_REF }}
    steps:
      - uses: actions/checkout@v4

      - name: Set up Node
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: Setup Supabase CLI and Deploy
        run: |
          npx supabase@latest login --token $SUPABASE_ACCESS_TOKEN
          npx supabase@latest functions deploy process-tasks --project-ref $SUPABASE_PROJECT_REF
